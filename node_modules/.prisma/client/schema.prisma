generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum currency {
  KES
  USD
  EUR
  CAD
  TSH
  UGX
  GBP
  ZWD
}

enum account_type {
  checking
  savings
  credit
  cash
  investment
}

enum period {
  monthly
  weekly
  yearly
}

enum source {
  manual
  plaid
  import
}

model User {
  id         String     @id @default(cuid(2))
  email      String     @unique
  full_name  String
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
  deleted_at DateTime? //optional
  accounts   Account[] //back relation
  categories Category[]
  budgets    Budget[]
  goals      Goal[]
}

model Account {
  account_id        String            @id @default(cuid(2))
  user_id           String
  user              User              @relation(fields: [user_id], references: [id])
  account_name      String
  account_type      String
  institution       String?
  currency          String            @default("USD")
  is_active         Boolean           @default(true)
  created_at        DateTime          @default(now())
  updated_at        DateTime          @updatedAt
  deleted_at        DateTime?
  transactions      Transaction[]
  external_accounts ExternalAccount[]

  @@index([user_id])
}

model Transaction {
  transaction_id   String    @id @default(cuid(2))
  account_id       String
  account          Account   @relation(fields: [account_id], references: [account_id])
  amount           Decimal   @db.Decimal(12, 2) //+income, -expense
  description      String
  transaction_date DateTime  @default(now())
  posted_date      DateTime  @default(now())
  source           String
  external_id      String?
  created_at       DateTime  @default(now())
  deleted_at       DateTime?

  @@index([account_id])
}

model Category {
  category_id String    @id @default(cuid(2))
  user_id     String
  user        User      @relation(fields: [user_id], references: [id])
  name        String
  created_at  DateTime  @default(now())
  deleted_at  DateTime?

  @@index([user_id])
}

model Budget {
  budget_id    String    @id @default(cuid(2))
  user_id      String
  user         User      @relation(fields: [user_id], references: [id])
  amount_limit Decimal   @db.Decimal(12, 2)
  period       String //monthly/weekly...
  start_date   DateTime
  end_date     DateTime
  created_at   DateTime  @default(now())
  deleted_at   DateTime?

  @@index([user_id])
}

model Goal {
  goal_id       String    @id @default(cuid(2))
  user_id       String
  user          User      @relation(fields: [user_id], references: [id])
  name          String
  target_amount Decimal   @db.Decimal(12, 2)
  target_date   DateTime
  created_at    DateTime  @default(now())
  deleted_at    DateTime?

  @@index([user_id])
}

model ExternalAccount {
  external_account_id String   @id @default(cuid(2))
  account_id          String
  account             Account  @relation(fields: [account_id], references: [account_id])
  provider            String
  provider_account_id String
  created_at          DateTime @default(now())
}
